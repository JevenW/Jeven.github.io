[{"title":"科学上网：Vultr VPS 搭建 Shadowsocks","url":"/2019/02/20/Shadowsocks/","content":"\n\n## 购置服务器\n直接进入 Vultr 官网购置即可。\n\n## 搭建 Shadowsocks\n### 连接 SSH\n使用命令：`ssh root@server_ip`\n\n### 安装 BBR 加速\n#### 预备工作\nCentOS：`yum -y install wget`\nDebian/Ubuntu：`apt install -y wget`\n\n#### 开始安装\n使用命令：\n`wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh && chmod +x bbr.sh && ./bbr.sh`\n\n#### 查看是否安装成功\n使用命令：`lsmod | grep bbr`\n观察是否显示「tcp_bbr」字样，如有，则安装成功。\n\n### 安装 Shadowsocks\n依次运行下面三行命令。\n\n#### 下载脚本\n使用命令：\n`wget — no-check-certificate -O shadowsocks.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh`\n\n#### 更改权限\n使用命令：`chmod +x shadowsocks.sh`\n\n#### 运行脚本\n使用命令：`./shadowsocks.sh 2>&1 | tee shadowsocks.log`\n\n根据屏幕提示，依次输入 密码，端口，选择加密方式。\n\n服务端搭建完成！\n\n### 多用户配置\n#### 准备配置信息\n```\n# 1.先设置好端口和对应的密码\n# 2.添加或删除的用户都在 \"port_password\"{……} 中\n# 3.用户信息格式，注意末尾的英文逗号：\"端口\"：\"密码\",  如 \"8006\": \"123456\",\n# 4.\"method\" 为加密方式，可修改，默认也可以，客户端的加密方式也是这个\n\n{\n    \"server\":\"45.63.85.38\",\n    \"local_address\":\"127.0.0.1\",\n    \"local_port\":1080,\n    \"port_password\":{\n         \"16880\":\"EG3BRUKnJSPx\",\n         \"16881\":\"95d1fSFyQ8gC\",\n         \"16882\":\"mv9okkgwiyZI\",\n         \"16883\":\"eV#$rXsi&wnW\",\n         \"16884\":\"Lh6c9$Gx!987\",\n         \"16885\":\"ybKDlZ1Zi4Oa\",\n\t     \"16886\":\"m4Zl7%og7X*8\",\n         \"16887\":\"s*P%eTswLb%c\",\n         \"16888\":\"Wy^rBVyVmS7q\"\n    },\n    \"timeout\":300,\n    \"method\":\"aes-256-cfb\",\n    \"fast_open\":true\n}\n```\n\n#### 创建配置文件\n使用命令：`vi /etc/shadowsocks.json`\n出现一列波浪线即进入 vim。按 `a` ，复制上面准备好的配置信息，再按 `Esc` ，输入 `:wq` 保存退出。\n\n#### 重启 Shadowsocks 生效\n使用命令：`/etc/init.d/shadowsocks restart`\n\n#### 开启端口\n配置完成后，多用户端口也许无法翻墙，这时需要去防火墙开启相应端口。\nCentOS 7:\n```\n//开启某个端口\nfirewall-cmd --permanent --zone=public --add-port=1080/tcp\nfirewall-cmd --permanent --zone=public --add-port=1080/udp\n\n//批量开启端口\nfirewall-cmd --permanent --zone=public --add-port=1080-1090/tcp\nfirewall-cmd --permanent --zone=public --add-port=1080-1090/udp\n```\n\n开启所有端口后，需要重启网络端口：`firewall-cmd --reload`\n\n大功告成！\n\n## 其他命令\n**查看内核版本：**`uname -r`\n**列出当前文件：**`ls`\n\n**防火墙：**\n\n```\n# 查看\nfirewall-cmd --zone= public --query-port=80/tcp\n\n# 删除\nfirewall-cmd --zone= public --remove-port=80/tcp --permanent\t\n\n# 查看防火墙已经开放的端口\nfirewall-cmd --list-ports\n\n# 重启网络端口\nfirewall-cmd --reload\t\n```\n\n**控制 Shadowsocks：**\n\n```\n# 启动\n/etc/init.d/shadowsocks start\n\n# 停止\n/etc/init.d/shadowsocks stop\n\n# 重启\n/etc/init.d/shadowsocks restart\n\n# 状态\n/etc/init.d/shadowsocks status\n\n# 卸载\n./shadowsocks.sh uninstall\n```\n\n**查看连接人数：**\n\n```\n# 假设服务器端口1080, 查看连接数\nsudo lsof -i -n -P | egrep -c ':1080.+ESTABLISHED'\n\n# 查看连接列表\nsudo lsof -i -n -P | egrep ':1080.+ESTABLISHED'\n```\n\n要测试各国家地区的线路，可以使用 Vultr 提供的测试 IP 和文件进行测速：[Vultr.com Frequently Asked Questions - Vultr.com](https://www.vultr.com/faq/#downloadspeedtests)\n\n","tags":["科学上网"]}]